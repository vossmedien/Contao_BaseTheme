{# Twig Template f√ºr das Auction Detail Modul #}


{# Einheitliche Datenstruktur erstellen #}
{% set raw_data = auction._raw_data|default({}) %}
{% if auction_var|default %}
    <div class="bg-primary text-white offset-wrapper">
        <div class="content--element head-hero ce_rsce_head_hero container-wide">
            <div class="ce--inner">
                <div class="breadcrumb-container mb-4 mb-md-3 animate__fadeIn animate__animated" data-animation="animate__fadeIn" style="animation-duration: 850ms; animation-delay: 0.1s;">
                    <!-- indexer::stop -->
                    {{ insert_tag('insert_module::20')|raw }}
                    <!-- indexer::continue -->
                </div>
                <div class="row">
                    <div class="col-12 col-xl-10">
                        <div class="ce--headline hl-h1 mb-gap">
                            <h1>
                                <span data-animation="animate__fadeIn" class="d-block">{{ 'auction_listing.card.title_prefix'|trans }}</span>
                                <span data-animation="animate__fadeIn">{{ raw_data.state }}</span>
                            </h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="container-wide auction-detail-box ">
            <div class="box-main bg-white text-body">
                <div class="row gx-0">
                    <div class="col-12 col-md-6 col-xxl-5">
                        {% set image_path = auction.blurred_picture_path|default(auction.picture_path|default(null)) %}
                        {% if image_path %}
                            <div class="auction-image-wrapper">
                                <div class="d-flex flex-nowrap">
                                    <span data-animation="animate__fadeIn" class="btn btn-secondary no-button btn-sm preview-btn">{{ 'auction_listing.card.preview_button'|trans }}</span>
                                    {% if raw_data.countDown is defined and raw_data.countDown > 0 %}
                                        {% set days_countdown = (raw_data.countDown / 86400)|round(0, 'ceil') %}
                                        {% if days_countdown > 0 %}
                                            {% set countdown_text = raw_data.status == 'STARTED' ? 'auction_listing.card.countdown_end_prefix' : 'auction_listing.card.countdown_prefix' %}
                                            <span data-animation="animate__fadeIn" class="btn btn-primary no-button btn-sm countdown-btn">{{ countdown_text|trans }} {{ days_countdown }} {{ 'auction_listing.card.countdown_suffix_days'|trans }}</span>
                                        {% endif %}
                                    {% endif %}
                                </div>
                                <img src="{{ image_path }}" alt="{{ 'auction_listing.card.image_alt_prefix'|trans }} {{ auction.id }}" class="auction-image img-fluid">

                                <div class="button-holder px-3 px-md-5 d-sm-flex d-md-block d-lg-flex flex-row gap-2 justify-content-between py-3">
                                    <div data-animation="animate__fadeInLeft" class="mb-2 mb-sm-0 mb-md-2 mb-lg-0">
                                        <strong class="d-block mb-1 small">{{ 'detail.new_customer_headline'|trans }}</strong>
                                        <a id="auction_new_customer_{{ auction.id }}" href="https://meetings-eu1.hubspot.com/pershin/terminbuchung-caeli-wind" target="_blank" class="auction_new_customer_btn btn btn-primary with-arrow btn-sm w-100">{{ 'detail.new_customer_button'|trans }}</a>
                                    </div>

                                    <div data-animation="animate__fadeInRight">
                                        <strong class="d-block mb-1 small">{{ 'detail.existing_customer_headline'|trans }}</strong>
                                        <a id="auction_existing_customer_{{ auction.id }}" href="https://auction.caeli-wind.de/" target="_blank" class="auction_existing_customer_btn btn btn-primary with-arrow btn-sm w-100">{{ 'detail.existing_customer_button'|trans }}</a>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    <div class="col-12 col-md-6 col-xxl-7">
                        <div class="px-gap mx-xl-3 py-4 auction-content" data-animation="animate__fadeIn">
                            <div class="auction-details-section">
                            <span class="auction-detail-label">
                                {{ 'auction_listing.card.details.power'|trans }}
                            </span>
                                <strong class="auction-detail-value">
                                    {% if app.request.locale == 'en' %}
                                        {{ raw_data.power|number_format(1, '.', ',') }} {{ 'auction_listing.card.unit.mw'|trans }}
                                    {% else %}
                                        {{ raw_data.power|number_format(1, ',', '.') }} {{ 'auction_listing.card.unit.mw'|trans }}
                                    {% endif %}
                                </strong>

                                <span class="auction-detail-label">
                                {{ 'auction_listing.card.details.area_size'|trans }}
                            </span>
                                <strong class="auction-detail-value">
                                    {% if app.request.locale == 'en' %}
                                        {{ raw_data.areaSize|number_format(1, '.', ',') }} {{ 'auction_listing.card.unit.ha'|trans }}
                                    {% else %}
                                        {{ raw_data.areaSize|number_format(1, ',', '.') }} {{ 'auction_listing.card.unit.ha'|trans }}
                                    {% endif %}
                                </strong>

                                <span class="auction-detail-label">
                                {{ 'auction_listing.card.details.full_usage_hours'|trans }}
                            </span>
                                <strong class="auction-detail-value">
                                    {% if app.request.locale == 'en' %}
                                        {{ raw_data.fullUsageHours|number_format(0, '.', ',') }} {{ 'auction_listing.card.unit.h_per_a'|trans }}
                                    {% else %}
                                        {{ raw_data.fullUsageHours|number_format(0, ',', '.') }} {{ 'auction_listing.card.unit.h_per_a'|trans }}
                                    {% endif %}
                                </strong>

                                <span class="auction-detail-label">
                                {{ 'auction_listing.card.details.irr_before_rent'|trans }}
                            </span>
                                <strong class="auction-detail-value">
                                    {% if app.request.locale == 'en' %}
                                        {{ raw_data.internalRateOfReturnBeforeRent|number_format(1, '.', ',') }} {{ 'auction_listing.card.unit.percent'|trans }}
                                    {% else %}
                                        {{ raw_data.internalRateOfReturnBeforeRent|number_format(1, ',', '.') }} {{ 'auction_listing.card.unit.percent'|trans }}
                                    {% endif %}
                                </strong>

                                {% if raw_data.weaHubHeight > 0 %}
                                    <span class="auction-detail-label">
                                {{ 'detail.hub_height'|trans }}
                            </span>
                                    <strong class="auction-detail-value">
                                        {% if app.request.locale == 'en' %}
                                            {{ raw_data.weaHubHeight|number_format(0, '.', ',') }} m
                                        {% else %}
                                            {{ raw_data.weaHubHeight|number_format(0, ',', '.') }} m
                                        {% endif %}
                                    </strong>
                                {% endif %}
                                <span class="auction-detail-label">
                                {{ 'detail.wea_count'|trans }}
                            </span>
                                <strong class="auction-detail-value">
                                    {{ raw_data.weaCount }}
                                </strong>

                                <span class="auction-detail-label">
                                {{ 'detail.avg_wind_speed'|trans }}
                            </span>
                                <strong class="auction-detail-value">
                                    {% if app.request.locale == 'en' %}
                                        {{ raw_data.averageWindSpeed|number_format(1, '.', ',') }} m/s
                                    {% else %}
                                        {{ raw_data.averageWindSpeed|number_format(1, ',', '.') }} m/s
                                    {% endif %}
                                </strong>


                                <span class="auction-detail-label">
                                {{ 'auction_listing.card.details.availability'|trans }}
                            </span>
                                <strong class="auction-detail-value">
                                    {% if raw_data.status == 'STARTED' or raw_data.status == 'OPEN_FOR_DIRECT_AWARDING' %}
                                        {{ 'marktplatz.as_of_now'|trans }}
                                    {% else %}
                                        {{ 'auction_listing.card.details.availability_prefix'|trans }} {{ raw_data.availableFrom }}
                                    {% endif %}
                                </strong>
                            </div>

                            <div class="mt-3">
                                <strong class="d-block mb-1">{{ 'detail.planning_law_headline'|trans }}</strong>
                                <span>{{ 'detail.planning_law_info_text'|trans }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box-footer bg-secondary text-body px-gap py-4 small">

                <strong class="d-block mb-2">{{ 'detail.area_status_headline'|trans }}
                    <i class="fak fa-info text-tertiary ms-1 fs-5"
                       data-bs-toggle="popover"
                       data-bs-placement="top"
                       data-bs-html="true"
                       data-bs-content="<div class='text-start'><span class='d-block'><i class='fak fa-check'></i> {{ 'detail.status_legend.completed'|trans }}</span><span class='d-block my-2'><i class='fak fa-recycling'></i> {{ 'detail.status_legend.in_progress'|trans }}</span><span class='d-block'><i class='fak fa-hourglass'></i> {{ 'detail.status_legend.requested'|trans }}</span></div>"
                       title="{{ 'detail.status_legend.title'|trans }}"></i>
                </strong>

                {% set area_progress_items = [
                    { 'label_key': 'detail.area_progress.planning_law', 'key': 'planningLawCheck' },
                    { 'label_key': 'detail.area_progress.faunistics', 'key': 'faunisticsCheck' },
                    { 'label_key': 'detail.area_progress.air_traffic', 'key': 'airTrafficCheck' },
                    { 'label_key': 'detail.area_progress.park_planning', 'key': 'parkPlanningCheck' },
                    { 'label_key': 'detail.area_progress.documentation', 'key': 'documentationCheck' },
                    { 'label_key': 'detail.area_progress.restrictions', 'key': 'restrictionsCheck' },
                    { 'label_key': 'detail.area_progress.armed_forces', 'key': 'armedForcesCheck' },
                    { 'label_key': 'detail.area_progress.inspection', 'key': 'inspectionCheck' },
                    { 'label_key': 'detail.area_progress.power_connection', 'key': 'powerConnectionCheck' },
                    { 'label_key': 'detail.area_progress.preparation', 'key': 'preparationCheck' }
                ] %}

                <div style="--bs-gutter-x: .5rem; --bs-gutter-y: .5rem; white-space: nowrap;" class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-xxl-5">
                    {% for item in area_progress_items %}
                        <div class="col" data-animation="animate__fadeIn">
                            {% set status = raw_data.areaProgress[item.key]|default('NOT_OK') %}
                            {% if status == 'OK' %}
                                {% set icon_class = 'fa-check' %}
                            {% elseif status == 'IN_PROGRESS' %}
                                {% set icon_class = 'fa-recycling' %}
                            {% else %}
                                {% set icon_class = 'fa-hourglass' %}
                            {% endif %}
                            <i class="fak {{ icon_class }}"></i>{{ item.label_key|trans }}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

    </div>
    {#
{% elseif error|default %}
    <div class="my-gap container">
        <div class="alert alert-danger">
            <p>{{ error }}</p>
        </div>
    </div>#}
{% else %}
    <div class="content--element  ce_rsce_headline bg-primary is-fullwidth layout-two-columns mb-gap">
        <div class="ce--inner container">
            <div>
                <div class="row  gy-lg-0 gx-lg-3 align-items-center">
                    <div data-animation="animate__fadeIn" class="col-12 col-lg-6 order-lg-1 order-1 headline-column">
                        <div class="">
                            <div class="headline-wrapper">
                                <div class="ce--headline hl-h2">
                                    <h2 style="">
                                        {{ 'detail.no_longer_available.headline'|trans }}
                                    </h2>
                                </div>
                            </div>
                            <div class="text">
                                <p>{{ 'detail.no_longer_available.description'|trans }}</p>
                            </div>
                            <div class="buttons text-lg-start mt-4">
                                <div class="ce--buttons">
                                    <a class="btn btn-xl btn-outline-white with-arrow" href="/marktplatz" id="klick-flaechenangebot-pe-seite">{{ 'detail.no_longer_available.button_text'|trans }}</a></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 order-lg-2 order-2 ">
                        <div class="content-column mt-4 mt-lg-0">
                            <div class="text">
                                <div>
                                    {{ insert_tag('insert_node::8')|raw }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}
